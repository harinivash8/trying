#!/bin/bash
set -e
set -o pipefail

LOG_FILE="/tmp/codedeploy_before_install.log"
echo "Running BeforeInstall..." >> $LOG_FILE

# Create application directory
mkdir -p /home/ec2-user/trying >> $LOG_FILE 2>&1

# Install Docker if not installed
if ! [ -x "$(command -v docker)" ]; then
  echo "Docker not found. Installing..." >> $LOG_FILE
  sudo yum install docker -y >> $LOG_FILE 2>&1
  sudo service docker start >> $LOG_FILE 2>&1
  sudo usermod -a -G docker ec2-user >> $LOG_FILE 2>&1
  sudo systemctl enable docker >> $LOG_FILE 2>&1
else
  echo "Docker already installed." >> $LOG_FILE
fi

echo "BeforeInstall completed." >> $LOG_FILE
